<section class="timeline-section" id="timeline" *ngIf="events().length">
  <div class="tl-header container">
    <div class="tl-title-row">
      <h2 class="section-title">My Journey</h2>
      <div class="tl-legend">
        <span *ngFor="let entry of [
          {type:'education',   label:'Education'},
          {type:'work',        label:'Work'},
          {type:'certification',label:'Certs'},
          {type:'project',     label:'Project'},
          {type:'achievement', label:'Achievement'}
        ]" class="legend-pill">
          <span class="legend-dot" [style.background]="getTypeColor(entry.type)"></span>
          <span>{{ entry.label }}</span>
        </span>
      </div>
    </div>
    <p class="tl-hint mono">
      <i class="fas fa-hand-pointer"></i> Drag or scroll &nbsp;Â·&nbsp;
      <i class="fas fa-mouse-pointer"></i> Click a node to jump to that section
    </p>
  </div>

  <!-- Progress scrubber -->
  <div class="tl-progress-bar">
    <div class="tl-progress-fill" [style.width.%]="progressWidth()"></div>
  </div>

  <!-- The horizontal scrollable rail -->
  <div class="tl-rail" #rail>
    <div class="tl-track" #track [style.min-width.px]="yearMarkers().length * 800">


      <!-- Spine line -->
      <div class="tl-spine"></div>

      <!-- Year markers -->
      <div *ngFor="let year of yearMarkers()" class="tl-year-marker" [style.left.%]="getYearX(year)">
        <span class="year-label mono">{{ year }}</span>
        <div class="year-tick"></div>
      </div>

      <!-- Nodes -->
      <div *ngFor="let ev of events(); let i = index" class="tl-node-wrap" [class]="getLabelSide(i)"
        [class.active]="activeId() === ev.id" [class.highlight]="ev.highlight" [style.left.%]="getRelativeX(ev.date)"
        (click)="onNodeClick(ev, $event)" [attr.title]="ev.label">

        <!-- Connector stem (above or below spine) -->
        <div class="tl-stem"></div>

        <!-- Node circle -->
        <div class="tl-node glass embossed" [style.--node-color]="getTypeColor(ev.type)">
          <i class="fas" [class]="ev.icon"></i>
          <div class="node-ring"></div>
          <div class="node-pulse" *ngIf="ev.highlight"></div>
        </div>

        <!-- Label card -->
        <div class="tl-label glass embossed" [class.expanded]="expandedId() === ev.id">
          <span class="tl-type-badge mono" [style.color]="getTypeColor(ev.type)">
            {{ getTypeLabel(ev.type) }}
          </span>
          <p class="tl-label-text">{{ ev.label }}</p>
          <p class="tl-date mono">{{ formatDate(ev.date) }}</p>

          <!-- Expanded detail card -->
          <div class="tl-detail" *ngIf="expandedId() === ev.id">
            <p class="tl-detail-text">{{ ev.detail }}</p>
            <button class="tl-go-btn" (click)="$event.stopPropagation(); scrollToSection(ev.sectionId)">
              <i class="fas fa-arrow-right"></i>
              <span>Go to section</span>
            </button>
          </div>
        </div>
      </div>

      <!-- "Today" marker -->
      <div class="tl-today-marker" [style.left.%]="todayPercentage()">
        <div class="today-line"></div>
        <div class="today-badge-wrap">
          <span class="today-badge mono">Today</span>
          <div class="today-info glass embossed">
            <div class="info-label mono">Current Time</div>
            <div class="info-value">{{ currentTimeString() }}</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Mini timeline scrubber -->
  <div class="tl-scrubber-container container">
    <div class="tl-sub-title mono">Quick Select</div>
    <div class="tl-mini-scrubber glass embossed">
      <div *ngFor="let year of yearMarkers()" class="scrubber-year mono" [class.active]="activeYear() === year"
        (click)="jumpToYear(year)">
        {{ year }}
      </div>
    </div>
    <div class="scrubber-hint mono">
      <i class="fas fa-magic"></i> Click any year to jump to that period
    </div>
  </div>
</section>